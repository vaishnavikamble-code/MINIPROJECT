<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholarship Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2ecc71;
            --secondary-dark: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #f5f5f5;
            --dark: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .header-title {
            color: white;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.filled {
            border-left: 5px solid var(--secondary);
        }

        .stat-card.not-filled {
            border-left: 5px solid var(--danger);
        }

        .stat-card.total {
            border-left: 5px solid var(--primary);
        }

        .stat-card h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
        }

        .stat-card .filled-number {
            color: var(--secondary);
        }

        .stat-card .not-filled-number {
            color: var(--danger);
        }

        .stat-card .total-number {
            color: var(--primary);
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        select, button, input {
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 14px;
            outline: none;
        }

        select {
            background-color: white;
            min-width: 150px;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        .btn-pdf {
            background-color: var(--danger);
        }

        .btn-pdf:hover {
            background-color: #c0392b;
        }

        .btn-refresh {
            background-color: var(--secondary);
        }

        .btn-refresh:hover {
            background-color: var(--secondary-dark);
        }

        .btn-add {
            background-color: var(--warning);
        }

        .btn-add:hover {
            background-color: #d68910;
        }

        .btn-submit {
            background-color: var(--secondary);
            width: 100%;
            justify-content: center;
        }

        .btn-submit:hover {
            background-color: var(--secondary-dark);
        }

        .btn-cancel {
            background-color: var(--danger);
            width: 100%;
            justify-content: center;
        }

        .btn-cancel:hover {
            background-color: #c0392b;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 500;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status.filled {
            background-color: #e8f7ee;
            color: var(--secondary-dark);
        }

        .status.not-filled {
            background-color: #fceae8;
            color: var(--danger);
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }

        .pagination button {
            min-width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            background-color: white;
            color: var(--dark);
            border: 1px solid #ddd;
        }

        .pagination button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
            }
            
            select, button, input {
                width: 100%;
            }
            
            .stat-card {
                min-width: 100%;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            outline: none;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            font-size: 16px;
            color: #888;
        }

        .progress-container {
            width: 100%;
            background-color: #f1f1f1;
            border-radius: 5px;
            margin-top: 5px;
        }

        .progress-bar {
            height: 10px;
            border-radius: 5px;
            background-color: var(--secondary);
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--primary);
            border-top: 5px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Add Student Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }

        .close {
            color: #aaa;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .validation-error {
            color: var(--danger);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .alert {
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Admin Panel Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="loading" id="loadingIndicator">
        <div class="spinner"></div>
    </div>

    <header>
        <div class="container">
            <h1 class="header-title"><i class="fas fa-graduation-cap"></i>Scholarship Management System</h1>
        </div>
    </header>

    <div class="container">
        <!-- Admin Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="student-management">Student Management</div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <div class="stats-container">
                    <div class="stat-card total">
                        <h3>Total Students</h3>
                        <div class="number total-number" id="totalStudents">0</div>
                    </div>
                    <div class="stat-card filled">
                        <h3>Filled Forms</h3>
                        <div class="number filled-number" id="filledForms">0</div>
                        <div class="progress-container">
                            <div class="progress-bar" id="filledProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card not-filled">
                        <h3>Not Filled Forms</h3>
                        <div class="number not-filled-number" id="notFilledForms">0</div>
                        <div class="progress-container">
                            <div class="progress-bar" id="notFilledProgress" style="background-color: #e74c3c; width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="filters">
                    <select id="departmentFilter">
                        <option value="all">All Departments</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Mechanical Engineering">Mechanical Engineering</option>
                        <option value="Electrical Engineering">Electrical Engineering</option>
                        <option value="Civil Engineering">Civil Engineering</option>
                        <option value="Information Technology">Information Technology</option>
                    </select>

                    <select id="yearFilter">
                        <option value="all">All Years</option>
                        <option value="1">First Year</option>
                        <option value="2">Second Year</option>
                        <option value="3">Third Year</option>
                        <option value="4">Fourth Year</option>
                    </select>

                    <select id="statusFilter">
                        <option value="all">All Status</option>
                        <option value="filled">Filled</option>
                        <option value="not-filled">Not Filled</option>
                    </select>

                    <button id="applyFilters" class="btn-filter">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>

                    <button id="generatePDF" class="btn-pdf">
                        <i class="fas fa-file-pdf"></i> Generate PDF
                    </button>

                    <button id="refreshData" class="btn-refresh">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>

                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search by name, ID, department...">
                </div>

                <div style="overflow-x: auto;">
                    <table id="scholarshipTable">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Department</th>
                                <th>Year</th>
                                <th>Status</th>
                                <th>Last Updated</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Table data will be dynamically populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="pagination" id="pagination">
                    <!-- Pagination buttons will be added here -->
                </div>
            </div>
        </div>

        <!-- Student Management Tab -->
        <div id="student-management" class="tab-content">
            <div class="card">
                <h1>Student Management</h1>
                <div id="studentAlertContainer"></div>
                
                <button id="addStudentBtn" class="btn-add">
                    <i class="fas fa-plus"></i> Add New Student
                </button>

                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="managementSearchInput" placeholder="Search by name, ID, department...">
                </div>

                <div style="overflow-x: auto;">
                    <table id="managementTable">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Department</th>
                                <th>Year</th>
                                <th>Status</th>
                                <th>Last Updated</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="managementTableBody">
                            <!-- Table data will be dynamically populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="pagination" id="managementPagination">
                    <!-- Pagination buttons will be added here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-user-plus"></i> Add New Student</h2>
                <span class="close" id="closeModal">&times;</span>
            </div>
            <div id="modalAlertContainer"></div>
            <form id="addStudentForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="studentId">Student ID</label>
                        <input type="text" class="form-control" id="studentId" placeholder="e.g., S2023031">
                        <div class="validation-error" id="studentIdError">Please enter a valid Student ID.</div>
                    </div>
                    <div class="form-group">
                        <label for="studentName">Full Name</label>
                        <input type="text" class="form-control" id="studentName" placeholder="e.g., John Smith">
                        <div class="validation-error" id="studentNameError">Please enter student's full name.</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="department">Department</label>
                        <select class="form-control" id="department">
                            <option value="">Select Department</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Mechanical Engineering">Mechanical Engineering</option>
                            <option value="Electrical Engineering">Electrical Engineering</option>
                            <option value="Civil Engineering">Civil Engineering</option>
                            <option value="Information Technology">Information Technology</option>
                        </select>
                        <div class="validation-error" id="departmentError">Please select a department.</div>
                    </div>
                    <div class="form-group">
                        <label for="year">Year</label>
                        <select class="form-control" id="year">
                            <option value="">Select Year</option>
                            <option value="1">First Year</option>
                            <option value="2">Second Year</option>
                            <option value="3">Third Year</option>
                            <option value="4">Fourth Year</option>
                        </select>
                        <div class="validation-error" id="yearError">Please select a year.</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="status">Scholarship Form Status</label>
                    <select class="form-control" id="status">
                        <option value="">Select Status</option>
                        <option value="filled">Filled</option>
                        <option value="not-filled">Not Filled</option>
                    </select>
                    <div class="validation-error" id="statusError">Please select a status.</div>
                </div>

                <div class="form-group" id="lastUpdatedGroup">
                    <label for="lastUpdated">Last Updated Date</label>
                    <input type="date" class="form-control" id="lastUpdated">
                    <div class="validation-error" id="lastUpdatedError">Please enter a valid date.</div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn-cancel" id="cancelAddStudent">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn-submit" id="submitAddStudent">
                        <i class="fas fa-save"></i> Add Student
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Mock data for demonstration - In a real application, this would come from a server/database
        let students = [
            { id: "S2023001", name: "John Smith", department: "Computer Science", year: "2", status: "filled", lastUpdated: "2025-03-10" },
            { id: "S2023002", name: "Emma Johnson", department: "Computer Science", year: "2", status: "filled", lastUpdated: "2025-03-12" },
            { id: "S2023003", name: "Michael Williams", department: "Computer Science", year: "1", status: "not-filled", lastUpdated: "-" },
            { id: "S2023004", name: "Olivia Brown", department: "Mechanical Engineering", year: "3", status: "filled", lastUpdated: "2025-03-08" },
            { id: "S2023005", name: "James Jones", department: "Mechanical Engineering", year: "3", status: "not-filled", lastUpdated: "-" },
            { id: "S2023006", name: "Sophia Garcia", department: "Electrical Engineering", year: "4", status: "filled", lastUpdated: "2025-03-15" },
            { id: "S2023007", name: "William Miller", department: "Electrical Engineering", year: "2", status: "not-filled", lastUpdated: "-" },
            { id: "S2023008", name: "Isabella Davis", department: "Civil Engineering", year: "1", status: "filled", lastUpdated: "2025-03-11" },
            { id: "S2023009", name: "Benjamin Rodriguez", department: "Civil Engineering", year: "4", status: "not-filled", lastUpdated: "-" },
            { id: "S2023010", name: "Mia Martinez", department: "Information Technology", year: "3", status: "filled", lastUpdated: "2025-03-14" },
            { id: "S2023011", name: "Charlotte Hernandez", department: "Computer Science", year: "1", status: "filled", lastUpdated: "2025-03-18" },
            { id: "S2023012", name: "Elijah Lopez", department: "Information Technology", year: "2", status: "not-filled", lastUpdated: "-" },
            { id: "S2023013", name: "Amelia Gonzalez", department: "Mechanical Engineering", year: "4", status: "filled", lastUpdated: "2025-03-05" },
            { id: "S2023014", name: "Lucas Wilson", department: "Computer Science", year: "3", status: "not-filled", lastUpdated: "-" },
            { id: "S2023015", name: "Harper Anderson", department: "Electrical Engineering", year: "1", status: "filled", lastUpdated: "2025-03-17" },
            { id: "S2023016", name: "Mason Thomas", department: "Civil Engineering", year: "2", status: "not-filled", lastUpdated: "-" },
            { id: "S2023017", name: "Evelyn Taylor", department: "Information Technology", year: "4", status: "filled", lastUpdated: "2025-03-09" },
            { id: "S2023018", name: "Logan Moore", department: "Computer Science", year: "3", status: "not-filled", lastUpdated: "-" },
            { id: "S2023019", name: "Abigail Jackson", department: "Mechanical Engineering", year: "1", status: "filled", lastUpdated: "2025-03-16" },
            { id: "S2023020", name: "Aiden White", department: "Electrical Engineering", year: "2", status: "not-filled", lastUpdated: "-" },
            { id: "S2023021", name: "Ella Harris", department: "Civil Engineering", year: "4", status: "filled", lastUpdated: "2025-03-07" },
            { id: "S2023022", name: "Carter Martin", department: "Information Technology", year: "1", status: "not-filled", lastUpdated: "-" },
            { id: "S2023023", name: "Scarlett Thompson", department: "Computer Science", year: "2", status: "filled", lastUpdated: "2025-03-13" },
            { id: "S2023024", name: "Grayson Garcia", department: "Mechanical Engineering", year: "3", status: "not-filled", lastUpdated: "-" },
            { id: "S2023025", name: "Aria Martinez", department: "Electrical Engineering", year: "4", status: "filled", lastUpdated: "2025-03-19" },
            { id: "S2023026", name: "Luke Robinson", department: "Civil Engineering", year: "1", status: "not-filled", lastUpdated: "-" },
            { id: "S2023027", name: "Lily Clark", department: "Information Technology", year: "2", status: "filled", lastUpdated: "2025-03-06" },
            { id: "S2023028", name: "Julian Rodriguez", department: "Computer Science", year: "3", status: "not-filled", lastUpdated: "-" },
            { id: "S2023029", name: "Aubrey Lewis", department: "Mechanical Engineering", year: "4", status: "filled", lastUpdated: "2025-03-20" },
            { id: "S2023030", name: "Jack Lee", department: "Electrical Engineering", year: "1", status: "not-filled", lastUpdated: "-" }
        ];

        // Global state
        let filteredStudents = [...students];
        let managementFilteredStudents = [...students];
        const itemsPerPage = 10;
        let currentPage = 1;
        let managementCurrentPage = 1;

        // DOM Elements
        const tableBody = document.getElementById('tableBody');
        const managementTableBody = document.getElementById('managementTableBody');
        const totalStudentsElement = document.getElementById('totalStudents');
        const filledFormsElement = document.getElementById('filledForms');
        const notFilledFormsElement = document.getElementById('notFilledForms');
        const filledProgressElement = document.getElementById('filledProgress');
        const notFilledProgressElement = document.getElementById('notFilledProgress');
        const paginationElement = document.getElementById('pagination');
        const managementPaginationElement = document.getElementById('managementPagination');
        const departmentFilter = document.getElementById('departmentFilter');
        const yearFilter = document.getElementById('yearFilter');
        const statusFilter = document.getElementById('statusFilter');
        const applyFiltersButton = document.getElementById('applyFilters');
        const generatePDFButton = document.getElementById('generatePDF');
        const refreshDataButton = document.getElementById('refreshData');
        const searchInput = document.getElementById('searchInput');
        const managementSearchInput = document.getElementById('managementSearchInput');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const addStudentModal = document.getElementById('addStudentModal');
        const addStudentBtn = document.getElementById('addStudentBtn');
        const closeModal = document.getElementById('closeModal');
        const cancelAddStudent = document.getElementById('cancelAddStudent');
        const addStudentForm = document.getElementById('addStudentForm');
        const lastUpdatedGroup = document.getElementById('lastUpdatedGroup');
        const studentAlertContainer = document.getElementById('studentAlertContainer');
        const modalAlertContainer = document.getElementById('modalAlertContainer');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateStatistics(students);
            filterAndDisplayStudents();
            filterAndDisplayManagementStudents();

            // Event Listeners
            applyFiltersButton.addEventListener('click', filterAndDisplayStudents);
            generatePDFButton.addEventListener('click', generatePDF);
            refreshDataButton.addEventListener('click', refreshData);
            searchInput.addEventListener('input', filterAndDisplayStudents);
            managementSearchInput.addEventListener('input', filterAndDisplayManagementStudents);
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Make tab active
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show tab content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabId) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // Modal event listeners
            addStudentBtn.addEventListener('click', openAddStudentModal);
            closeModal.addEventListener('click', closeAddStudentModal);
            cancelAddStudent.addEventListener('click', closeAddStudentModal);
            addStudentForm.addEventListener('submit', handleAddStudentSubmit);
            
            // Additional student management event delegation
            managementTableBody.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-edit') || e.target.parentElement.classList.contains('btn-edit')) {
                    const row = e.target.closest('tr');
                    const studentId = row.getAttribute('data-id');
                    editStudent(studentId);
                } else if (e.target.classList.contains('btn-delete') || e.target.parentElement.classList.contains('btn-delete')) {
                    const row = e.target.closest('tr');
                    const studentId = row.getAttribute('data-id');
                    deleteStudent(studentId);
                }
            });
            
            // Status change event
            document.getElementById('status').addEventListener('change', function(e) {
                const statusValue = e.target.value;
                if (statusValue === 'filled') {
                    lastUpdatedGroup.style.display = 'block';
                    document.getElementById('lastUpdated').value = new Date().toISOString().split('T')[0];
                } else {
                    lastUpdatedGroup.style.display = 'none';
                    document.getElementById('lastUpdated').value = '';
                }
            });
        });

        // Functions
        function updateStatistics(studentData) {
            const totalStudents = studentData.length;
            const filledForms = studentData.filter(student => student.status === 'filled').length;
            const notFilledForms = totalStudents - filledForms;
            
            totalStudentsElement.textContent = totalStudents;
            filledFormsElement.textContent = filledForms;
            notFilledFormsElement.textContent = notFilledForms;
            
            const filledPercentage = (filledForms / totalStudents) * 100;
            const notFilledPercentage = (notFilledForms / totalStudents) * 100;
            
            filledProgressElement.style.width = `${filledPercentage}%`;
            notFilledProgressElement.style.width = `${notFilledPercentage}%`;
        }

        function filterStudents() {
            const departmentValue = departmentFilter.value;
            const yearValue = yearFilter.value;
            const statusValue = statusFilter.value;
            const searchValue = searchInput.value.toLowerCase();
            
            return students.filter(student => {
                const departmentMatch = departmentValue === 'all' || student.department === departmentValue;
                const yearMatch = yearValue === 'all' || student.year === yearValue;
                const statusMatch = statusValue === 'all' || student.status === statusValue;
                const searchMatch = 
                    student.id.toLowerCase().includes(searchValue) || 
                    student.name.toLowerCase().includes(searchValue) || 
                    student.department.toLowerCase().includes(searchValue);
                
                return departmentMatch && yearMatch && statusMatch && searchMatch;
            });
        }

        function filterManagementStudents() {
            const searchValue = managementSearchInput.value.toLowerCase();
            
            return students.filter(student => {
                return student.id.toLowerCase().includes(searchValue) || 
                       student.name.toLowerCase().includes(searchValue) || 
                       student.department.toLowerCase().includes(searchValue);
            });
        }

        function filterAndDisplayStudents() {
            showLoading();
            
            setTimeout(() => {
                filteredStudents = filterStudents();
                updateStatistics(filteredStudents);
                displayStudents(filteredStudents, tableBody, paginationElement, currentPage);
                hideLoading();
            }, 300); // Simulate API delay
        }

        function filterAndDisplayManagementStudents() {
            showLoading();
            
            setTimeout(() => {
                managementFilteredStudents = filterManagementStudents();
                displayManagementStudents(managementFilteredStudents, managementTableBody, managementPaginationElement, managementCurrentPage);
                hideLoading();
            }, 300); // Simulate API delay
        }

        function displayStudents(studentsToDisplay, tableBodyElement, paginationElement, page) {
            // Clear table
            tableBodyElement.innerHTML = '';
            
            // Check if no data
            if (studentsToDisplay.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `<td colspan="6" class="no-data">No matching records found</td>`;
                tableBodyElement.appendChild(emptyRow);
                paginationElement.innerHTML = '';
                return;
            }
            
            // Calculate pagination
            const totalPages = Math.ceil(studentsToDisplay.length / itemsPerPage);
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedStudents = studentsToDisplay.slice(start, end);
            
            // Add rows
            paginatedStudents.forEach(student => {
                const row = document.createElement('tr');
                const statusClass = student.status === 'filled' ? 'filled' : 'not-filled';
                const statusText = student.status === 'filled' ? 'Filled' : 'Not Filled';
                
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.department}</td>
                    <td>${getYearText(student.year)}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td>${student.lastUpdated}</td>
                `;
                
                tableBodyElement.appendChild(row);
            });
            
            // Update pagination
            updatePagination(totalPages, page, paginationElement, 'changePage');
        }

        function displayManagementStudents(studentsToDisplay, tableBodyElement, paginationElement, page) {
            // Clear table
            tableBodyElement.innerHTML = '';
            
            // Check if no data
            if (studentsToDisplay.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `<td colspan="7" class="no-data">No matching records found</td>`;
                tableBodyElement.appendChild(emptyRow);
                paginationElement.innerHTML = '';
                return;
            }
            
            // Calculate pagination
            const totalPages = Math.ceil(studentsToDisplay.length / itemsPerPage);
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedStudents = studentsToDisplay.slice(start, end);
            
            // Add rows
            paginatedStudents.forEach(student => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', student.id);
                const statusClass = student.status === 'filled' ? 'filled' : 'not-filled';
                const statusText = student.status === 'filled' ? 'Filled' : 'Not Filled';
                
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.department}</td>
                    <td>${getYearText(student.year)}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td>${student.lastUpdated}</td>
                    <td>
                        <button class="btn-edit" style="background-color: var(--warning); margin-right: 5px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-delete" style="background-color: var(--danger);">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tableBodyElement.appendChild(row);
            });
            
            // Update pagination
            updatePagination(totalPages, page, paginationElement, 'changeManagementPage');
        }

        function updatePagination(totalPages, currentPageNum, paginationElement, changePageFunctionName) {
            paginationElement.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevButton = document.createElement('button');
            prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevButton.disabled = currentPageNum === 1;
            prevButton.addEventListener('click', () => window[changePageFunctionName](currentPageNum - 1));
            paginationElement.appendChild(prevButton);
            
            // Page buttons
            let startPage = Math.max(1, currentPageNum - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            if (endPage - startPage < 4 && startPage > 1) {
                startPage = Math.max(1, endPage - 4);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.classList.toggle('active', i === currentPageNum);
                pageButton.addEventListener('click', () => window[changePageFunctionName](i));
                paginationElement.appendChild(pageButton);
            }
            
            // Next button
            const nextButton = document.createElement('button');
            nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextButton.disabled = currentPageNum === totalPages;
            nextButton.addEventListener('click', () => window[changePageFunctionName](currentPageNum + 1));
            paginationElement.appendChild(nextButton);
        }

        // Global functions for pagination
        window.changePage = function(page) {
            currentPage = page;
            displayStudents(filteredStudents, tableBody, paginationElement, currentPage);
        };

        window.changeManagementPage = function(page) {
            managementCurrentPage = page;
            displayManagementStudents(managementFilteredStudents, managementTableBody, managementPaginationElement, managementCurrentPage);
        };

        function getYearText(yearValue) {
            const yearMap = {
                '1': 'First Year',
                '2': 'Second Year',
                '3': 'Third Year',
                '4': 'Fourth Year'
            };
            
            return yearMap[yearValue] || yearValue;
        }

        function generatePDF() {
            showLoading();
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(18);
                doc.text('Scholarship Management Report', 14, 20);
                
                // Add date
                doc.setFontSize(10);
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 14, 30);
                
                // Add statistics
                doc.setFontSize(12);
                doc.text(`Total Students: ${totalStudentsElement.textContent}`, 14, 40);
                doc.text(`Filled Forms: ${filledFormsElement.textContent} (${Math.round((filledFormsElement.textContent / totalStudentsElement.textContent) * 100)}%)`, 14, 50);
                doc.text(`Not Filled Forms: ${notFilledFormsElement.textContent} (${Math.round((notFilledFormsElement.textContent / totalStudentsElement.textContent) * 100)}%)`, 14, 60);
                
                // Add filter information
                doc.setFontSize(10);
                doc.text(`Department Filter: ${departmentFilter.options[departmentFilter.selectedIndex].text}`, 14, 70);
                doc.text(`Year Filter: ${yearFilter.options[yearFilter.selectedIndex].text}`, 14, 75);
                doc.text(`Status Filter: ${statusFilter.options[statusFilter.selectedIndex].text}`, 14, 80);
                
                // Create the table data
                const tableColumn = ["Student ID", "Name", "Department", "Year", "Status"];
                const tableRows = [];
                
                filteredStudents.forEach(student => {
                    const studentData = [
                        student.id,
                        student.name,
                        student.department,
                        getYearText(student.year),
                        student.status === 'filled' ? 'Filled' : 'Not Filled'
                    ];
                    tableRows.push(studentData);
                });
                
                // Add the table
                doc.autoTable({
                    head: [tableColumn],
                    body: tableRows,
                    startY: 90,
                    styles: { fontSize: 8 },
                    margin: { top: 90 }
                });
                
                // Save the PDF
                doc.save('scholarship-report.pdf');
                
                hideLoading();
            }, 1000);
        }

        function refreshData() {
            showLoading();
            
            setTimeout(() => {
                // In a real application, this would fetch fresh data from the server
                departmentFilter.value = 'all';
                yearFilter.value = 'all';
                statusFilter.value = 'all';
                searchInput.value = '';
                managementSearchInput.value = '';
                
                currentPage = 1;
                managementCurrentPage = 1;
                
                filteredStudents = [...students];
                managementFilteredStudents = [...students];
                
                updateStatistics(students);
                displayStudents(students, tableBody, paginationElement, currentPage);
                displayManagementStudents(students, managementTableBody, managementPaginationElement, managementCurrentPage);
                
                showAlert(studentAlertContainer, 'Data refreshed successfully!', 'success');
                
                hideLoading();
            }, 1000);
        }

        function showLoading() {
            loadingIndicator.style.display = 'flex';
        }

        function hideLoading() {
            loadingIndicator.style.display = 'none';
        }

        // Modal Functions
        function openAddStudentModal() {
            // Reset form
            addStudentForm.reset();
            
            // Hide validation errors
            document.querySelectorAll('.validation-error').forEach(el => {
                el.style.display = 'none';
            });
            
            // Hide last updated field by default
            lastUpdatedGroup.style.display = 'none';
            
            // Clear any previous alerts
            modalAlertContainer.innerHTML = '';
            
            // Show modal
            addStudentModal.style.display = 'block';
        }

        function closeAddStudentModal() {
            addStudentModal.style.display = 'none';
        }

        function validateAddStudentForm() {
            let isValid = true;
            
            // Validate Student ID
            const studentId = document.getElementById('studentId').value.trim();
            if (!studentId || !studentId.match(/^S\d{7}$/)) {
                document.getElementById('studentIdError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('studentIdError').style.display = 'none';
                
                // Check if ID already exists
                const existingStudent = students.find(s => s.id === studentId);
                if (existingStudent) {
                    document.getElementById('studentIdError').textContent = 'This Student ID already exists.';
                    document.getElementById('studentIdError').style.display = 'block';
                    isValid = false;
                }
            }
            
            // Validate Name
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName || studentName.length < 3) {
                document.getElementById('studentNameError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('studentNameError').style.display = 'none';
            }
            
            // Validate Department
            const department = document.getElementById('department').value;
            if (!department) {
                document.getElementById('departmentError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('departmentError').style.display = 'none';
            }
            
            // Validate Year
            const year = document.getElementById('year').value;
            if (!year) {
                document.getElementById('yearError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('yearError').style.display = 'none';
            }
            
            // Validate Status
            const status = document.getElementById('status').value;
            if (!status) {
                document.getElementById('statusError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('statusError').style.display = 'none';
            }
            
            // Validate Last Updated if status is "filled"
            if (status === 'filled') {
                const lastUpdated = document.getElementById('lastUpdated').value;
                if (!lastUpdated) {
                    document.getElementById('lastUpdatedError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('lastUpdatedError').style.display = 'none';
                }
            }
            
            return isValid;
        }

        function handleAddStudentSubmit(e) {
            e.preventDefault();
            
            if (!validateAddStudentForm()) {
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                const newStudent = {
                    id: document.getElementById('studentId').value.trim(),
                    name: document.getElementById('studentName').value.trim(),
                    department: document.getElementById('department').value,
                    year: document.getElementById('year').value,
                    status: document.getElementById('status').value,
                    lastUpdated: document.getElementById('status').value === 'filled' 
                        ? document.getElementById('lastUpdated').value 
                        : '-'
                };
                
                // Add to students array
                students.push(newStudent);
                
                // Refresh displays
                filteredStudents = [...students];
                managementFilteredStudents = [...students];
                
                updateStatistics(students);
                displayStudents(students, tableBody, paginationElement, 1);
                displayManagementStudents(students, managementTableBody, managementPaginationElement, 1);
                
                // Show success and close modal
                showAlert(modalAlertContainer, 'Student added successfully!', 'success');
                
                setTimeout(() => {
                    closeAddStudentModal();
                    // Also show alert in main interface
                    showAlert(studentAlertContainer, `Student ${newStudent.name} (${newStudent.id}) added successfully!`, 'success');
                }, 1000);
                
                hideLoading();
            }, 800);
        }

        function editStudent(studentId) {
            // Find student
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            // Open modal with student data
            openAddStudentModal();
            
            // Set values
            document.getElementById('studentId').value = student.id;
            document.getElementById('studentId').disabled = true; // Don't allow editing ID
            document.getElementById('studentName').value = student.name;
            document.getElementById('department').value = student.department;
            document.getElementById('year').value = student.year;
            document.getElementById('status').value = student.status;
            
            if (student.status === 'filled') {
                lastUpdatedGroup.style.display = 'block';
                document.getElementById('lastUpdated').value = student.lastUpdated;
            }
            
            // Change modal title and button text
            document.querySelector('.modal-title').innerHTML = '<i class="fas fa-user-edit"></i> Edit Student';
            document.getElementById('submitAddStudent').innerHTML = '<i class="fas fa-save"></i> Update Student';
            
            // Change form submission handler
            addStudentForm.removeEventListener('submit', handleAddStudentSubmit);
            addStudentForm.addEventListener('submit', (e) => handleEditStudentSubmit(e, studentId));
        }

        function handleEditStudentSubmit(e, studentId) {
            e.preventDefault();
            
            // Modified validation for edit (skip ID check)
            let isValid = true;
            
            // Validate Name
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName || studentName.length < 3) {
                document.getElementById('studentNameError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('studentNameError').style.display = 'none';
            }
            
            // Validate Department
            const department = document.getElementById('department').value;
            if (!department) {
                document.getElementById('departmentError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('departmentError').style.display = 'none';
            }
            
            // Validate Year
            const year = document.getElementById('year').value;
            if (!year) {
                document.getElementById('yearError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('yearError').style.display = 'none';
            }
            
            // Validate Status
            const status = document.getElementById('status').value;
            if (!status) {
                document.getElementById('statusError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('statusError').style.display = 'none';
            }
            
            // Validate Last Updated if status is "filled"
            if (status === 'filled') {
                const lastUpdated = document.getElementById('lastUpdated').value;
                if (!lastUpdated) {
                    document.getElementById('lastUpdatedError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('lastUpdatedError').style.display = 'none';
                }
            }
            
            if (!isValid) {
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                // Find and update student in array
                const studentIndex = students.findIndex(s => s.id === studentId);
                if (studentIndex !== -1) {
                    students[studentIndex] = {
                        ...students[studentIndex],
                        name: document.getElementById('studentName').value.trim(),
                        department: document.getElementById('department').value,
                        year: document.getElementById('year').value,
                        status: document.getElementById('status').value,
                        lastUpdated: document.getElementById('status').value === 'filled' 
                            ? document.getElementById('lastUpdated').value 
                            : '-'
                    };
                }
                
                // Refresh displays
                filteredStudents = filterStudents();
                managementFilteredStudents = filterManagementStudents();
                
                updateStatistics(students);
                displayStudents(filteredStudents, tableBody, paginationElement, currentPage);
                displayManagementStudents(managementFilteredStudents, managementTableBody, managementPaginationElement, managementCurrentPage);
                
                // Show success and close modal
                showAlert(modalAlertContainer, 'Student updated successfully!', 'success');
                
                setTimeout(() => {
                    closeAddStudentModal();
                    // Also show alert in main interface
                    showAlert(studentAlertContainer, `Student ${students[studentIndex].name} (${students[studentIndex].id}) updated successfully!`, 'success');
                }, 1000);
                
                hideLoading();
            }, 800);
        }

        function deleteStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!confirm(`Are you sure you want to delete ${student.name} (${student.id})?`)) {
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                // Remove student from array
                students = students.filter(s => s.id !== studentId);
                
                // Refresh displays
                filteredStudents = filterStudents();
                managementFilteredStudents = filterManagementStudents();
                
                updateStatistics(students);
                displayStudents(filteredStudents, tableBody, paginationElement, currentPage);
                displayManagementStudents(managementFilteredStudents, managementTableBody, managementPaginationElement, managementCurrentPage);
                
                // Show success message
                showAlert(studentAlertContainer, `Student ${student.name} (${student.id}) has been deleted.`, 'success');
                
                hideLoading();
            }, 800);
        }

        function showAlert(container, message, type) {
            // Clear any existing alerts
            container.innerHTML = '';
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            
            container.appendChild(alert);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                alert.style.display = 'none';
                setTimeout(() => {
                    container.innerHTML = '';
                }, 300);
            }, 5000);
        }

        // Window click event to close modal when clicking outside
        window.onclick = function(event) {
            if (event.target === addStudentModal) {
                closeAddStudentModal();
            }
        };
    </script>
</body>
</html>